<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>draftbench - Speculative Decoding Sweep</title>
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }
        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 10px;
        }
        h2 {
            text-align: center;
            color: #888;
            font-weight: normal;
            margin-top: 0;
        }
        .chart {
            background: #16213e;
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .chart-title {
            color: #fff;
            font-size: 1.2em;
            margin-bottom: 10px;
            padding-left: 10px;
        }
    </style>
</head>
<body>
    <h1>Speculative Decoding Benchmark</h1>
    <h2>Qwen2.5 on m4max-128gb (llamacpp)</h2>

    <div class="chart">
        <div class="chart-title">Throughput Comparison (tokens/sec)</div>
        <div id="summary-chart"></div>
    </div>

    <div class="chart">
        <div class="chart-title">Speedup vs Baseline (%)</div>
        <div id="speedup-chart"></div>
    </div>

    <div class="chart">
        <div class="chart-title">Full Results Heatmap (% Speedup)</div>
        <div id="heatmap-chart"></div>
    </div>

    <script>
        var darkLayout = {
            paper_bgcolor: '#16213e',
            plot_bgcolor: '#16213e',
            font: { color: '#eee' },
            xaxis: { gridcolor: '#2a3a5e', title: 'Target Model' },
            yaxis: { gridcolor: '#2a3a5e' },
        };

        var summaryTraces = [{"x": ["7B FP16", "7B Q8_0", "7B Q6_K", "7B Q5_K_M", "7B Q5_0", "7B Q4_K_M", "7B Q4_0", "7B Q3_K_M", "7B Q2_K"], "y": [33.63, 58.7, 70.97, 64.6, 73.69, 88.44, 91.44, 69.5, 83.74], "text": ["33.6", "58.7", "71.0", "64.6", "73.7", "88.4", "91.4", "69.5", "83.7"], "textposition": "outside", "name": "Baseline (no draft)", "type": "bar", "marker": {"color": "#636EFA"}}, {"x": ["7B FP16", "7B Q8_0", "7B Q6_K", "7B Q5_K_M", "7B Q5_0", "7B Q4_K_M", "7B Q4_0", "7B Q3_K_M", "7B Q2_K"], "y": [98.51, 105.88, 91.89, 89.45, 106.15, 100.56, 106.59, 81.75, 88.53], "text": ["98.5", "105.9", "91.9", "89.5", "106.2", "100.6", "106.6", "81.8", "88.5"], "textposition": "outside", "hovertext": ["0.5B Q4_0<br>98.5 tok/s<br>71% acceptance", "0.5B Q8_0<br>105.9 tok/s<br>73% acceptance", "0.5B Q8_0<br>91.9 tok/s<br>75% acceptance", "0.5B Q4_0<br>89.5 tok/s<br>71% acceptance", "0.5B Q4_0<br>106.2 tok/s<br>78% acceptance", "0.5B Q8_0<br>100.6 tok/s<br>75% acceptance", "0.5B Q3_K_M<br>106.6 tok/s<br>64% acceptance", "0.5B Q8_0<br>81.8 tok/s<br>74% acceptance", "0.5B Q4_0<br>88.5 tok/s<br>69% acceptance"], "hoverinfo": "text", "name": "Best 0.5B Draft", "type": "bar", "marker": {"color": "#EF553B"}}, {"x": ["7B FP16", "7B Q8_0", "7B Q6_K", "7B Q5_K_M", "7B Q5_0", "7B Q4_K_M", "7B Q4_0", "7B Q3_K_M", "7B Q2_K"], "y": [98.05, 102.46, 92.27, 90.0, 100.21, 95.29, 98.7, 79.91, 81.05], "text": ["98.0", "102.5", "92.3", "90.0", "100.2", "95.3", "98.7", "79.9", "81.0"], "textposition": "outside", "hovertext": ["1.5B Q4_0<br>98.0 tok/s<br>80% acceptance", "1.5B Q4_0<br>102.5 tok/s<br>81% acceptance", "1.5B Q4_K_M<br>92.3 tok/s<br>87% acceptance", "1.5B Q4_0<br>90.0 tok/s<br>81% acceptance", "1.5B Q4_0<br>100.2 tok/s<br>84% acceptance", "1.5B Q4_0<br>95.3 tok/s<br>80% acceptance", "1.5B Q4_K_M<br>98.7 tok/s<br>76% acceptance", "1.5B Q4_K_M<br>79.9 tok/s<br>79% acceptance", "1.5B Q4_K_M<br>81.0 tok/s<br>71% acceptance"], "hoverinfo": "text", "name": "Best 1.5B Draft", "type": "bar", "marker": {"color": "#00CC96"}}, {"x": ["7B FP16", "7B Q8_0", "7B Q6_K", "7B Q5_K_M", "7B Q5_0", "7B Q4_K_M", "7B Q4_0", "7B Q3_K_M", "7B Q2_K"], "y": [81.13, 83.14, 76.96, 75.92, 82.08, 79.31, 80.85, 68.31, 67.85], "text": ["81.1", "83.1", "77.0", "75.9", "82.1", "79.3", "80.8", "68.3", "67.8"], "textposition": "outside", "hovertext": ["3B Q4_0<br>81.1 tok/s<br>80% acceptance", "3B Q4_0<br>83.1 tok/s<br>82% acceptance", "3B Q4_0<br>77.0 tok/s<br>80% acceptance", "3B Q4_0<br>75.9 tok/s<br>83% acceptance", "3B Q4_K_M<br>82.1 tok/s<br>87% acceptance", "3B Q4_0<br>79.3 tok/s<br>82% acceptance", "3B Q4_0<br>80.8 tok/s<br>71% acceptance", "3B Q4_0<br>68.3 tok/s<br>75% acceptance", "3B Q4_0<br>67.8 tok/s<br>64% acceptance"], "hoverinfo": "text", "name": "Best 3B Draft", "type": "bar", "marker": {"color": "#AB63FA"}}];
        Plotly.newPlot('summary-chart', summaryTraces, {
            ...darkLayout,
            barmode: 'group',
            yaxis: { ...darkLayout.yaxis, title: 'Tokens per Second' },
            legend: { orientation: 'h', y: -0.15, font: { color: '#eee' } },
            margin: { b: 80, t: 20 },
            height: 400,
        }, { responsive: true });

        var speedupTraces = [{"x": ["7B FP16", "7B Q8_0", "7B Q6_K", "7B Q5_K_M", "7B Q5_0", "7B Q4_K_M", "7B Q4_0", "7B Q3_K_M", "7B Q2_K"], "y": [192.9, 80.4, 29.5, 38.5, 44.0, 13.7, 16.6, 17.6, 5.7], "text": ["+193%", "+80%", "+29%", "+38%", "+44%", "+14%", "+17%", "+18%", "+6%"], "textposition": "outside", "hovertext": ["0.5B Q4_0<br>+192.9% speedup<br>71% acceptance", "0.5B Q8_0<br>+80.4% speedup<br>73% acceptance", "0.5B Q8_0<br>+29.5% speedup<br>75% acceptance", "0.5B Q4_0<br>+38.5% speedup<br>71% acceptance", "0.5B Q4_0<br>+44.0% speedup<br>78% acceptance", "0.5B Q8_0<br>+13.7% speedup<br>75% acceptance", "0.5B Q3_K_M<br>+16.6% speedup<br>64% acceptance", "0.5B Q8_0<br>+17.6% speedup<br>74% acceptance", "0.5B Q4_0<br>+5.7% speedup<br>69% acceptance"], "hoverinfo": "text", "name": "Best 0.5B Draft", "type": "bar", "marker": {"color": "#EF553B"}}, {"x": ["7B FP16", "7B Q8_0", "7B Q6_K", "7B Q5_K_M", "7B Q5_0", "7B Q4_K_M", "7B Q4_0", "7B Q3_K_M", "7B Q2_K"], "y": [191.6, 74.5, 30.0, 39.3, 36.0, 7.7, 7.9, 15.0, -3.2], "text": ["+192%", "+75%", "+30%", "+39%", "+36%", "+8%", "+8%", "+15%", "+-3%"], "textposition": "outside", "hovertext": ["1.5B Q4_0<br>+191.6% speedup<br>80% acceptance", "1.5B Q4_0<br>+74.5% speedup<br>81% acceptance", "1.5B Q4_K_M<br>+30.0% speedup<br>87% acceptance", "1.5B Q4_0<br>+39.3% speedup<br>81% acceptance", "1.5B Q4_0<br>+36.0% speedup<br>84% acceptance", "1.5B Q4_0<br>+7.7% speedup<br>80% acceptance", "1.5B Q4_K_M<br>+7.9% speedup<br>76% acceptance", "1.5B Q4_K_M<br>+15.0% speedup<br>79% acceptance", "1.5B Q4_K_M<br>+-3.2% speedup<br>71% acceptance"], "hoverinfo": "text", "name": "Best 1.5B Draft", "type": "bar", "marker": {"color": "#00CC96"}}, {"x": ["7B FP16", "7B Q8_0", "7B Q6_K", "7B Q5_K_M", "7B Q5_0", "7B Q4_K_M", "7B Q4_0", "7B Q3_K_M", "7B Q2_K"], "y": [141.2, 41.6, 8.4, 17.5, 11.4, -10.3, -11.6, -1.7, -19.0], "text": ["+141%", "+42%", "+8%", "+18%", "+11%", "+-10%", "+-12%", "+-2%", "+-19%"], "textposition": "outside", "hovertext": ["3B Q4_0<br>+141.2% speedup<br>80% acceptance", "3B Q4_0<br>+41.6% speedup<br>82% acceptance", "3B Q4_0<br>+8.4% speedup<br>80% acceptance", "3B Q4_0<br>+17.5% speedup<br>83% acceptance", "3B Q4_K_M<br>+11.4% speedup<br>87% acceptance", "3B Q4_0<br>+-10.3% speedup<br>82% acceptance", "3B Q4_0<br>+-11.6% speedup<br>71% acceptance", "3B Q4_0<br>+-1.7% speedup<br>75% acceptance", "3B Q4_0<br>+-19.0% speedup<br>64% acceptance"], "hoverinfo": "text", "name": "Best 3B Draft", "type": "bar", "marker": {"color": "#AB63FA"}}];
        Plotly.newPlot('speedup-chart', speedupTraces, {
            ...darkLayout,
            barmode: 'group',
            yaxis: { ...darkLayout.yaxis, title: 'Speedup (%)' },
            legend: { orientation: 'h', y: -0.15, font: { color: '#eee' } },
            margin: { b: 80, t: 20 },
            height: 400,
            shapes: [{
                type: 'line', x0: 0, x1: 1, xref: 'paper',
                y0: 0, y1: 0, yref: 'y',
                line: { color: '#666', width: 2, dash: 'dash' }
            }]
        }, { responsive: true });

        var heatmapTrace = [{
            z: [[169.2, 66.3, 20.9, 28.9, 33.5, 6.2, 7.2, 10.4, -3.2], [175.3, 76.0, 23.3, 32.6, 38.6, 8.9, 11.4, 12.5, 1.1], [187.1, 79.5, 28.6, 37.5, 42.5, 11.3, 16.6, 16.1, 3.8], [192.9, 80.3, 26.3, 38.5, 44.0, 11.9, 16.0, 15.6, 5.7], [186.1, 77.4, 27.2, 35.5, 41.8, 10.6, 14.8, 16.6, 2.5], [182.6, 76.7, 25.3, 35.2, 41.2, 9.0, 14.2, 15.5, 1.8], [184.1, 76.7, 27.0, 36.4, 42.0, 11.6, 16.4, 16.7, 2.6], [186.9, 79.7, 28.7, 35.9, 41.7, 12.8, 14.7, 16.8, 3.2], [189.3, 80.4, 29.5, 37.5, 42.0, 13.7, 14.9, 17.6, 3.2], [111.3, 24.3, -3.7, 4.5, -3.4, -20.9, -23.5, -13.1, -28.3], [134.2, 47.3, 3.4, 12.9, 14.8, -8.6, -7.4, -2.8, -13.6], [153.6, 54.7, 15.2, 25.1, 21.3, -3.1, -3.1, 5.0, -10.7], [191.6, 74.5, 29.6, 39.3, 36.0, 7.7, 7.2, 14.6, -3.6], [187.5, 73.3, 30.0, 39.2, 33.6, 7.7, 7.9, 15.0, -3.2], [175.9, 62.5, 23.4, 31.8, 26.7, 2.5, 0.3, 11.6, -6.1], [166.7, 58.1, 20.5, 30.5, 23.4, -0.1, -0.7, 8.3, -10.1], [178.2, 65.8, 26.1, 35.2, 26.8, 4.9, 1.9, 11.3, -7.6], [165.9, 57.1, 20.3, 29.4, 20.8, -0.4, -3.0, 6.8, -12.3], [42.6, -15.0, -33.8, -26.8, -32.4, -46.9, -48.1, -39.6, -52.0], [141.2, 41.6, 8.4, 17.5, 11.2, -10.3, -11.6, -1.7, -19.0], [136.4, 39.3, 6.6, 16.3, 11.4, -12.7, -14.1, -3.3, -21.5], [96.1, 15.7, -11.2, -3.3, -7.6, -27.1, -28.0, -18.4, -35.5]],
            x: ["7B FP16", "7B Q8_0", "7B Q6_K", "7B Q5_K_M", "7B Q5_0", "7B Q4_K_M", "7B Q4_0", "7B Q3_K_M", "7B Q2_K"],
            y: ["0.5B FP16", "0.5B Q2_K", "0.5B Q3_K_M", "0.5B Q4_0", "0.5B Q4_K_M", "0.5B Q5_0", "0.5B Q5_K_M", "0.5B Q6_K", "0.5B Q8_0", "1.5B FP16", "1.5B Q2_K", "1.5B Q3_K_M", "1.5B Q4_0", "1.5B Q4_K_M", "1.5B Q5_0", "1.5B Q5_K_M", "1.5B Q6_K", "1.5B Q8_0", "3B FP16", "3B Q4_0", "3B Q4_K_M", "3B Q8_0"],
            hovertemplate: '<b>%{y}</b> â†’ %{x}<br>Speedup: <b>%{z:.1f}%</b><extra></extra>',
            type: 'heatmap',
            colorscale: [
                [0, '#dc3545'],
                [0.4, '#fd7e14'],
                [0.5, '#ffc107'],
                [0.7, '#28a745'],
                [1, '#00ff88']
            ],
            zmin: 0,
            zmax: 85,
            colorbar: {
                title: 'Speedup %',
                tickfont: { color: '#eee', size: 14 },
                titlefont: { color: '#eee', size: 14 },
                tickvals: [0, 20, 40, 60, 80],
                ticktext: ['0%', '+20%', '+40%', '+60%', '+80%'],
                len: 0.9
            },
            hoverongaps: false,
            xgap: 2,
            ygap: 1,
        }];

        var numDrafts = ["0.5B FP16", "0.5B Q2_K", "0.5B Q3_K_M", "0.5B Q4_0", "0.5B Q4_K_M", "0.5B Q5_0", "0.5B Q5_K_M", "0.5B Q6_K", "0.5B Q8_0", "1.5B FP16", "1.5B Q2_K", "1.5B Q3_K_M", "1.5B Q4_0", "1.5B Q4_K_M", "1.5B Q5_0", "1.5B Q5_K_M", "1.5B Q6_K", "1.5B Q8_0", "3B FP16", "3B Q4_0", "3B Q4_K_M", "3B Q8_0"].length;
        var heatmapHeight = Math.max(500, numDrafts * 22 + 100);

        Plotly.newPlot('heatmap-chart', heatmapTrace, {
            ...darkLayout,
            xaxis: {
                ...darkLayout.xaxis,
                side: 'top',
                tickfont: { size: 14, color: '#eee' },
                tickangle: 0
            },
            yaxis: {
                ...darkLayout.yaxis,
                title: '',
                autorange: 'reversed',
                tickfont: { size: 12, color: '#eee' },
                dtick: 1
            },
            margin: { l: 100, t: 50, b: 20, r: 100 },
            height: heatmapHeight,
        }, { responsive: true });
    </script>
</body>
</html>